<!DOCTYPE html>
<html lang="en">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-96x96.png">
  <link rel="mask-icon" href="/images/favicon.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha256-5eIC48iZUHmSlSUz9XtjRyK2mzQkHScZY1WdMaoz74E=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"lucmann.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.21.1","exturl":false,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":false,"nav":{"disqus":{"text":"Load Disqus","order":-1}},"activeClass":"disqus"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":true}}</script><script src="/js/config.js"></script>

    <meta name="description" content="ç¯å¢ƒå‡†å¤‡  WSL2 ä½œä¸ºä¸Šä½æœº  è¯†åˆ« Windows 11 Host çš„ USB Serial Device åˆ†åˆ«åœ¨ Windows 11 ä¸Šå®‰è£… usbipd-winï¼Œ åœ¨ WSL2 ä¸Šå®‰è£… user space tools for USB&#x2F;IP 1234567Microsoft Windows [ç‰ˆæœ¬ 10.0.22621.1702](c) Microsoft Corporationã€‚ä¿">
<meta property="og:type" content="article">
<meta property="og:title" content="HiKey970">
<meta property="og:url" content="https://lucmann.github.io/hw/hikey970/index.html">
<meta property="og:site_name" content="Eureka">
<meta property="og:description" content="ç¯å¢ƒå‡†å¤‡  WSL2 ä½œä¸ºä¸Šä½æœº  è¯†åˆ« Windows 11 Host çš„ USB Serial Device åˆ†åˆ«åœ¨ Windows 11 ä¸Šå®‰è£… usbipd-winï¼Œ åœ¨ WSL2 ä¸Šå®‰è£… user space tools for USB&#x2F;IP 1234567Microsoft Windows [ç‰ˆæœ¬ 10.0.22621.1702](c) Microsoft Corporationã€‚ä¿">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://lucmann.github.io/images/hikey970/USB-Serial.png">
<meta property="og:image" content="https://lucmann.github.io/images/hikey970/exar-USB-SER-driver.png">
<meta property="og:image" content="https://lucmann.github.io/images/hikey970/huawei-USB-SER-driver.png">
<meta property="og:image" content="https://lucmann.github.io/images/hikey970/hikey970-boot.png">
<meta property="og:image" content="https://lucmann.github.io/images/hikey970/hikey970-power.jpg">
<meta property="og:image" content="https://lucmann.github.io/images/hikey970/wifi-connect.png">
<meta property="og:image" content="https://lucmann.github.io/images/hikey970/hikey970-wifi-led.jpg">
<meta property="og:image" content="https://lucmann.github.io/images/hikey970/hikey970-xfce4.jpg">
<meta property="og:image" content="https://lucmann.github.io/images/hikey970/debian-vs-ubuntu.png">
<meta property="og:image" content="https://lucmann.github.io/images/hikey970/hikey970-display.svg">
<meta property="og:image" content="https://lucmann.github.io/images/hikey970/dsi_probe_ordering_comparison.svg">
<meta property="og:image" content="https://lucmann.github.io/images/hikey970/try-latest-kernel-on-hikey970.png">
<meta property="og:image" content="https://lucmann.github.io/images/hikey970/try-latest-kernel-on-hikey970-2.png">
<meta property="og:image" content="https://lucmann.github.io/images/hikey970/BootManager.png">
<meta property="og:image" content="https://lucmann.github.io/images/hikey970/DevicesList.png">
<meta property="og:image" content="https://lucmann.github.io/images/hikey970/BootFromFile.png">
<meta property="og:image" content="https://lucmann.github.io/images/hikey970/boot_sdcard_0x30a7d232_0x3f_0x7ffc1.png">
<meta property="og:image" content="https://lucmann.github.io/images/hikey970/grub.png">
<meta property="article:published_time" content="2023-06-14T07:00:41.000Z">
<meta property="article:modified_time" content="2026-02-28T06:13:08.370Z">
<meta property="article:author" content="Luc">
<meta property="article:tag" content="Hardware">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://lucmann.github.io/images/hikey970/USB-Serial.png">


<link rel="canonical" href="https://lucmann.github.io/hw/hikey970/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://lucmann.github.io/hw/hikey970/","path":"hw/hikey970/","title":"HiKey970"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>HiKey970 | Eureka</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><!-- hexo-inject:begin --><!-- hexo-inject:end --></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Eureka</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="Searching..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="nav-number">1.</span> <span class="nav-text"> ç¯å¢ƒå‡†å¤‡</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#wsl2-%E4%BD%9C%E4%B8%BA%E4%B8%8A%E4%BD%8D%E6%9C%BA"><span class="nav-number">1.1.</span> <span class="nav-text"> WSL2 ä½œä¸ºä¸Šä½æœº</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%86%E5%88%AB-windows-11-host-%E7%9A%84-usb-serial-device"><span class="nav-number">1.1.1.</span> <span class="nav-text"> è¯†åˆ« Windows 11 Host çš„ USB Serial Device</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#wsl2-ubuntu-2004-%E5%88%9B%E5%BB%BA-devttyusb0"><span class="nav-number">1.1.2.</span> <span class="nav-text"> WSL2 Ubuntu-20.04 åˆ›å»º &#x2F;dev&#x2F;ttyUSB0</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#recovery-%E6%A8%A1%E5%BC%8F%E5%BA%94%E8%AF%A5%E8%BF%9E%E6%8E%A5%E5%93%AA%E4%B8%AA-type-c-usb-serial-%E6%8E%A5%E5%8F%A3"><span class="nav-number">1.1.3.</span> <span class="nav-text"> Recovery æ¨¡å¼åº”è¯¥è¿æ¥å“ªä¸ª Type-C ï¼ˆUSB SERIAL) æ¥å£</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#build-rootfsimg-and-bootimg"><span class="nav-number">2.</span> <span class="nav-text"> Build rootfs.img and boot.img</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#bootimg"><span class="nav-number">2.1.</span> <span class="nav-text"> boot.img</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#rootfsimg"><span class="nav-number">2.2.</span> <span class="nav-text"> rootfs.img</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#debootstrap"><span class="nav-number">2.3.</span> <span class="nav-text"> debootstrap</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#fastboot"><span class="nav-number">3.</span> <span class="nav-text"> fastboot</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#fastboot-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="nav-number">3.1.</span> <span class="nav-text"> fastboot å¸¸ç”¨å‘½ä»¤</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%90%AF%E5%8A%A8"><span class="nav-number">4.</span> <span class="nav-text"> å¯åŠ¨</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#bootloader"><span class="nav-number">4.1.</span> <span class="nav-text"> Bootloader</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BF%9E%E6%8E%A5-wifi"><span class="nav-number">4.2.</span> <span class="nav-text"> è¿æ¥ WiFi</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#xfce4-%E6%A1%8C%E9%9D%A2"><span class="nav-number">4.3.</span> <span class="nav-text"> xfce4 æ¡Œé¢</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%B6%E4%BD%9C-rootfs-initramfs"><span class="nav-number">5.</span> <span class="nav-text"> åˆ¶ä½œ rootfs, initramfs</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#networkmanager-vs-wpasupplicant"><span class="nav-number">5.1.</span> <span class="nav-text"> NetworkManager vs wpasupplicant</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#display-on-hikey970"><span class="nav-number">6.</span> <span class="nav-text"> Display on HiKey970</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#dsi-bridge-probe"><span class="nav-number">6.1.</span> <span class="nav-text"> DSI bridge probe</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#panfrost-on-hikey970"><span class="nav-number">7.</span> <span class="nav-text"> Panfrost on HiKey970</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#v619"><span class="nav-number">7.1.</span> <span class="nav-text"> v6.19</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#random-crng-init-done-took-70-minutes"><span class="nav-number">7.1.1.</span> <span class="nav-text"> random: crng init done took 70 minutes</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sd-%E5%8D%A1%E4%B8%8D%E8%AF%86%E5%88%AB"><span class="nav-number">7.1.2.</span> <span class="nav-text"> SD å¡ä¸è¯†åˆ«</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sd-%E5%8D%A1%E5%90%AF%E5%8A%A8"><span class="nav-number">7.1.3.</span> <span class="nav-text"> SD å¡å¯åŠ¨</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-number">8.</span> <span class="nav-text"> å‚è€ƒ</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Luc</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">132</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">26</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/lucmann" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;lucmann" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:onion0709@gmail.com" title="E-Mail â†’ mailto:onion0709@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://lucmann.github.io/hw/hikey970/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Luc">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Eureka">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="HiKey970 | Eureka">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          HiKey970
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2023-06-14 15:00:41" itemprop="dateCreated datePublished" datetime="2023-06-14T15:00:41+08:00">2023-06-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/hardware/" itemprop="url" rel="index"><span itemprop="name">hardware</span></a>
        </span>
    </span>

  
    <span id="/hw/hikey970/" class="post-meta-item leancloud_visitors" data-flag-title="HiKey970" title="Views">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span class="leancloud-visitors-count"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus: </span>
    
    <a title="disqus" href="/hw/hikey970/#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="hw/hikey970/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="ç¯å¢ƒå‡†å¤‡"><a class="markdownIt-Anchor" href="#ç¯å¢ƒå‡†å¤‡"></a> ç¯å¢ƒå‡†å¤‡</h1>
<h2 id="wsl2-ä½œä¸ºä¸Šä½æœº"><a class="markdownIt-Anchor" href="#wsl2-ä½œä¸ºä¸Šä½æœº"></a> WSL2 ä½œä¸ºä¸Šä½æœº</h2>
<h3 id="è¯†åˆ«-windows-11-host-çš„-usb-serial-device"><a class="markdownIt-Anchor" href="#è¯†åˆ«-windows-11-host-çš„-usb-serial-device"></a> è¯†åˆ« Windows 11 Host çš„ USB Serial Device</h3>
<p>åˆ†åˆ«åœ¨ Windows 11 ä¸Šå®‰è£… <a target="_blank" rel="noopener" href="https://github.com/dorssel/usbipd-win">usbipd-win</a>ï¼Œ åœ¨ WSL2 ä¸Šå®‰è£… <a target="_blank" rel="noopener" href="https://github.com/dorssel/usbipd-win/wiki/WSL-support">user space tools for USB/IP</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Microsoft Windows [ç‰ˆæœ¬ 10.0.22621.1702]</span><br><span class="line">(c) Microsoft Corporationã€‚ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚</span><br><span class="line"></span><br><span class="line">C:\Windows\System32&gt;usbipd wsl list</span><br><span class="line">BUSID  VID:PID    DEVICE                                                        STATE</span><br><span class="line">1-9    046d:c534  USB è¾“å…¥è®¾å¤‡                                                  Not attached</span><br><span class="line">1-13   04e2:1410  USB ä¸²è¡Œè®¾å¤‡ (COM4)                                           Not attached</span><br></pre></td></tr></table></figure>
<h3 id="wsl2-ubuntu-2004-åˆ›å»º-devttyusb0"><a class="markdownIt-Anchor" href="#wsl2-ubuntu-2004-åˆ›å»º-devttyusb0"></a> WSL2 Ubuntu-20.04 åˆ›å»º /dev/ttyUSB0</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[Thu Jun 15 19:19:44 2023] vhci_hcd vhci_hcd.0: pdev(0) rhport(0) sockfd(3)</span><br><span class="line">[Thu Jun 15 19:19:44 2023] vhci_hcd vhci_hcd.0: devid(65546) speed(2) speed_str(full-speed)</span><br><span class="line">[Thu Jun 15 19:19:44 2023] vhci_hcd vhci_hcd.0: Device attached</span><br><span class="line">[Thu Jun 15 19:19:45 2023] vhci_hcd: vhci_device speed not set</span><br><span class="line">[Thu Jun 15 19:19:45 2023] usb 1-1: new full-speed USB device number 2 using vhci_hcd</span><br><span class="line">[Thu Jun 15 19:19:45 2023] vhci_hcd: vhci_device speed not set</span><br><span class="line">[Thu Jun 15 19:19:45 2023] usb 1-1: SetAddress Request (2) to port 0</span><br><span class="line">[Thu Jun 15 19:19:45 2023] usb 1-1: New USB device found, idVendor=04e2, idProduct=1410, bcdDevice= 0.03</span><br><span class="line">[Thu Jun 15 19:19:45 2023] usb 1-1: New USB device strings: Mfr=0, Product=0, SerialNumber=0</span><br><span class="line">[Thu Jun 15 19:19:45 2023] xr_serial 1-1:1.0: xr_serial converter detected</span><br><span class="line">[Thu Jun 15 19:19:45 2023] usb 1-1: xr_serial converter now attached to ttyUSB0</span><br></pre></td></tr></table></figure>
<h3 id="recovery-æ¨¡å¼åº”è¯¥è¿æ¥å“ªä¸ª-type-c-usb-serial-æ¥å£"><a class="markdownIt-Anchor" href="#recovery-æ¨¡å¼åº”è¯¥è¿æ¥å“ªä¸ª-type-c-usb-serial-æ¥å£"></a> Recovery æ¨¡å¼åº”è¯¥è¿æ¥å“ªä¸ª Type-C ï¼ˆUSB SERIAL) æ¥å£</h3>
<p>HiKey970 æœ‰ä¸¤ä¸ª Type-C æ¥å£ï¼Œè€Œä¸”å½“æ¿å­è¢«è®¾ç½®ä¸º Recovery æ¨¡å¼æ—¶ï¼Œä¸¤ä¸ªæ¥å£å‡ä¼šè¢«è¯†åˆ«ä¸ºâ€œä¸²å£â€ã€‚åœ¨å·¦æ‰‹è¾¹çš„ (J3101) æ˜¯ç”¨æ¥è®¿é—® Debug UART çš„ï¼Œè€Œåœ¨ HDMI å’Œ USB ä¸­é—´çš„é‚£ä¸ª(J1801)æ˜¯åœ¨ Recovery æ¨¡å¼ä¸‹ä½¿ç”¨çš„ã€‚è€Œä¸”è¿™ä¸¤ä¸ªæ¥å£æ˜¯ä¸¤ä¸ªä¸åŒå‚å®¶æä¾›çš„èŠ¯ç‰‡ï¼Œä½¿ç”¨å®Œå…¨ä¸åŒçš„å†…æ ¸é©±åŠ¨æ¨¡å—</p>
<p><img src="/images/hikey970/USB-Serial.png" alt="USB-to-Serial on Hikey970" /></p>
<ul>
<li>å‰è€…(J3101)ï¼š<br />
<code>Bus 001 Device 003: ID 04e2:1410 Exar Corp. XR21V1410 USB-UART IC</code></li>
</ul>
<p><img src="/images/hikey970/exar-USB-SER-driver.png" alt="Select CONFIG_USB_SERIAL_XR on WSL2 Kernal config" /></p>
<ul>
<li>åè€…(J1801)ï¼š<br />
<code>Bus 001 Device 002: ID 12d1:3609 Huawei Technologies Co., Ltd. USB SER</code></li>
</ul>
<p><img src="/images/hikey970/huawei-USB-SER-driver.png" alt="Select CONFIG_USB_SERIAL_OPTION on WSL2 Kernel config" /></p>
<h1 id="build-rootfsimg-and-bootimg"><a class="markdownIt-Anchor" href="#build-rootfsimg-and-bootimg"></a> Build rootfs.img and boot.img</h1>
<h2 id="bootimg"><a class="markdownIt-Anchor" href="#bootimg"></a> boot.img</h2>
<p><code>boot.img</code> ä¸»è¦æä¾› bootloader, æ‰€ä»¥å®ƒå¯ä»¥åªåŒ…å« <strong>grub.efi</strong>, Hikey970 ä½¿ç”¨çš„ boot.img æ˜¯ 64M å¤§å°</p>
<h2 id="rootfsimg"><a class="markdownIt-Anchor" href="#rootfsimg"></a> rootfs.img</h2>
<p><code>rootfs.img</code> å°±æ˜¯æ•´ä¸ªç³»ç»Ÿäº†(æ ¹æ–‡ä»¶ç³»ç»Ÿ)ï¼Œå†…æ ¸å¯æ‰§è¡Œæ–‡ä»¶(Image)å’Œè®¾å¤‡æ ‘äºŒè¿›åˆ¶æ–‡ä»¶(.dtb) éƒ½åŒ…å«åœ¨å®ƒçš„ boot ç›®å½•é‡Œï¼ŒHikey970 ä½¿ç”¨çš„ rootfs.img åŸå§‹å¤§å°æ˜¯ 4.0GB, ä½†ç»è¿‡ android-tools å·¥å…·åŒ…é‡Œçš„ <code>img2simg</code> å¤„ç†ååªæœ‰ 716M</p>
<figure class="highlight plaintext"><figcaption><span>image ä¸ Raw image å¤§å°å¯¹æ¯”</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-rw-r--r-- 1 luc luc 4.0G 11æœˆ26æ—¥ 06:48 rootfs.img</span><br><span class="line">-rw-r--r-- 1 luc luc 716M 11æœˆ18æ—¥ 21:47 rootfs.sparse.img</span><br></pre></td></tr></table></figure>
<h2 id="debootstrap"><a class="markdownIt-Anchor" href="#debootstrap"></a> debootstrap</h2>
<ul>
<li><code>/usr/sbin/qemu-debootstrap</code></li>
<li><code>/usr/sbin/debootstrap</code></li>
</ul>
<p>æ˜¯ä¸¤ä¸ª <strong>Shell è„šæœ¬</strong>, ä¸»è¦å°±æ˜¯é€šè¿‡ä¸‹è½½ç›¸åº”å¹³å°çš„ binariesï¼Œé€šè¿‡ <strong>chroot</strong> æ¥åˆ¶ä½œæ ¹æ–‡ä»¶ç³»ç»Ÿ</p>
<h1 id="fastboot"><a class="markdownIt-Anchor" href="#fastboot"></a> fastboot</h1>
<p>fastboot æ˜¯ç”¨æ¥ä» Host å‘å¼€å‘æ¿çƒ§å†™å›ºä»¶å’Œé•œåƒçš„å¸¸ç”¨å·¥å…·ä¹‹ä¸€ï¼Œåœ¨ Arch Linux ä¸Šå®ƒå¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤å®‰è£…</p>
<figure class="highlight plaintext"><figcaption><span>fastboot</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yay -S android-sdk-platform-tools</span><br></pre></td></tr></table></figure>
<h2 id="fastboot-å¸¸ç”¨å‘½ä»¤"><a class="markdownIt-Anchor" href="#fastboot-å¸¸ç”¨å‘½ä»¤"></a> fastboot å¸¸ç”¨å‘½ä»¤</h2>
<figure class="highlight plaintext"><figcaption><span>bootloader è·å–å„ç§ä¿¡æ¯ï¼Œå¦‚ version, partition</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastboot getvar all</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><figcaption><span>ID, å¯ä»¥ç”¨æ¥åˆ¤æ–­è®¾å¤‡æ˜¯å¦å·²ä¸ Host æ­£å¸¸è¿æ¥å°±ç»ª</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastboot devices</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fastboot flash ptable 64gtoendprm_ptable.img</span><br><span class="line">fastboot flash xloader sec_xloader.img</span><br><span class="line">fastboot flash fastboot l-loader.bin</span><br><span class="line">fastboot flash fip fip.bin</span><br><span class="line">fastboot flash boot boot2grub.uefi.img</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><figcaption><span>Sparse é•œåƒï¼ŒæŒ‡å®šä¼ è¾“å—å¤§å°ï¼Œæ¯ 8M ä¼ è¾“</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fastboot -S 8M flash system rootfs.sparse.img</span><br></pre></td></tr></table></figure>
<h1 id="å¯åŠ¨"><a class="markdownIt-Anchor" href="#å¯åŠ¨"></a> å¯åŠ¨</h1>
<h2 id="bootloader"><a class="markdownIt-Anchor" href="#bootloader"></a> Bootloader</h2>
<figure class="highlight plaintext"><figcaption><span>mount -o loop boot2grub.uefi.img</span><a href="/mnt">link</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">âœ  /mnt ls -lh /mnt/EFI/BOOT</span><br><span class="line">æ€»è®¡ 881K</span><br><span class="line">-rwxr-xr-x 1 root root  29K 2018å¹´ 2æœˆ14æ—¥ fastboot.efi</span><br><span class="line">-rwxr-xr-x 1 root root 852K 2018å¹´ 2æœˆ14æ—¥ grubaa64.efi</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><figcaption><span>/boot ç›®å½•</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">hikey970% ls -lhR /boot</span><br><span class="line">/boot:</span><br><span class="line">total 23M</span><br><span class="line">drwxr-xr-x 3 root root 4.0K Jun 12  2018 EFI</span><br><span class="line">-rw-r--r-- 1 root root  23M Jun 12  2018 Image</span><br><span class="line">drwxr-xr-x 2 root root 4.0K Jun 12  2018 grub</span><br><span class="line">-rw-r--r-- 1 root root  68K Jun 12  2018 kirin970-hikey970.dtb</span><br><span class="line"></span><br><span class="line">/boot/EFI:</span><br><span class="line">total 4.0K</span><br><span class="line">drwxr-xr-x 2 root root 4.0K Jun 12  2018 BOOT</span><br><span class="line"></span><br><span class="line">/boot/EFI/BOOT:</span><br><span class="line">total 32K</span><br><span class="line">-rw-r--r-- 1 root root 29K Jun 12  2018 fastboot.efi</span><br><span class="line"></span><br><span class="line">/boot/grub:</span><br><span class="line">total 4.0K</span><br><span class="line">-rw-r--r-- 1 root root 462 Jun 12  2018 grub.cfg</span><br></pre></td></tr></table></figure>
<p><img src="/images/hikey970/hikey970-boot.png" alt="Hikey970 boot ubuntu bionic" /></p>
<blockquote>
<p><strong>NOTE:</strong><br />
HiKey970 çš„è¾“å…¥ç”µå‹è¦æ±‚åœ¨ 8V ~ 18V ä¹‹é—´ï¼Œä½†æœ€å¥½ä½¿ç”¨ <strong>12V ä»¥ä¸Šæ¥è¿‘ 18V</strong>çš„è¾“å…¥ç”µå‹ï¼Œå¦åˆ™å¯èƒ½å‡ºç° <code>fastboot flash</code> æ—¶å‡ºç°æ¿å­è‡ªå·±é‡å¯çš„æ€ªç°è±¡<br />
<img src="/images/hikey970/hikey970-power.jpg" alt="Hikey970 Input Power Voltage" /></p>
</blockquote>
<h2 id="è¿æ¥-wifi"><a class="markdownIt-Anchor" href="#è¿æ¥-wifi"></a> è¿æ¥ WiFi</h2>
<p><img src="/images/hikey970/wifi-connect.png" alt="Hikey970 wifi" /></p>
<p><img src="/images/hikey970/hikey970-wifi-led.jpg" alt="Hikey970 WiFi LED indicator" /></p>
<h2 id="xfce4-æ¡Œé¢"><a class="markdownIt-Anchor" href="#xfce4-æ¡Œé¢"></a> xfce4 æ¡Œé¢</h2>
<p>åƒç°5,6å¹´çš„æ¿å­åˆå†ä¸€æ¬¡äº®äº†</p>
<p><img src="/images/hikey970/hikey970-xfce4.jpg" alt="Hikey970 xfce4" /></p>
<h1 id="åˆ¶ä½œ-rootfs-initramfs"><a class="markdownIt-Anchor" href="#åˆ¶ä½œ-rootfs-initramfs"></a> åˆ¶ä½œ rootfs, initramfs</h1>
<p>ç¯å¢ƒæ˜¯ qemu-system-aarch64 Debian 13 Trixie, æŠ˜è…¾äº†ä¸€åœˆï¼Œæœ€åè¿˜æ˜¯å‘ç° Ubuntu, Debian, Arch Linux è¿™3ä¸ªï¼Œè¿˜æ˜¯ Debian å¯¹ Aarch64 æ”¯æŒæœ€å¥½ï¼ŒUbuntu ç”šè‡³è¿˜ä¸€ä¸ªæ¡Œé¢ç‰ˆçš„ Arm å®‰è£…é•œåƒéƒ½æ²¡æœ‰(Armæ¶æ„çš„å®‰è£…é•œåƒä¼¼ä¹éƒ½æ˜¯æœåŠ¡å™¨ç‰ˆçš„)ã€‚</p>
<p><img src="/images/hikey970/debian-vs-ubuntu.png" alt="Debian vs. Ubuntu" /></p>
<h2 id="networkmanager-vs-wpasupplicant"><a class="markdownIt-Anchor" href="#networkmanager-vs-wpasupplicant"></a> NetworkManager vs wpasupplicant</h2>
<p>ç‚¹äº®å¹ç° Hikey970 ç”¨çš„æ˜¯ <a target="_blank" rel="noopener" href="https://github.com/mengzhuo/hikey970-ubuntu-image">hikey970-ubuntu-image</a>, å®ƒçš„ rootfs é‡Œå®‰è£…çš„æ˜¯ NetworkManager, å½“æˆ‘è¯•ç€å°† hikey970-ubuntu-image è½¬æ¢æˆ hikey970-debian-image æ—¶ï¼Œå‘ç° debootstrap ä¼šå› ä¸ºå¥‡æ€ªçš„åŒ…ä¾èµ–é—®é¢˜ï¼Œæ— æ³•å®‰è£… NetworkManagerï¼Œ è€Œä¸”äº†è§£åˆ° wpasupplicant å¯ä»¥å®ŒæˆåŒæ ·çš„äº‹æƒ…(è¿æ¥ WiFi,è®©æ¿å­è”ç½‘), è€Œä¸”ä½“é‡æ›´å°ï¼Œæ›´é€‚åˆè¿™ç§å¼€å‘æ¿ã€‚</p>
<p>æ‰€ä»¥è¿™ä¸ª Debian 12 rootfs ç½‘ç»œè¿™å—ä½¿ç”¨äº† <strong>wpasupplicant</strong>, <strong>iw</strong>, <strong>iproute2</strong>, <strong>dhcpcd5</strong> å››å‰‘å®¢</p>
<ul>
<li>wpasupplicant</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=WPA supplicant daemon (interface %i)</span><br><span class="line">After=sys-subsystem-net-devices-%i.device</span><br><span class="line">Wants=sys-subsystem-net-devices-%i.device</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=simple</span><br><span class="line">ExecStart=/sbin/wpa_supplicant -c /etc/wpa_supplicant/wpa_supplicant.conf -i %i</span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<p>Note:</p>
<ol>
<li>å½“ <code>systemctl enable wpa_supplicant@wlan0.service</code> æ—¶ systemd ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªç¬¦å·é“¾æ¥æ–‡ä»¶åˆ° <code>/etc/systemd/system/wpa_supplicant@.service</code>, è€Œæ–‡ä»¶é‡Œçš„ <code>%i</code> æ˜¯æ— çº¿ç½‘ç»œè®¾å¤‡æ¥å£åï¼Œå³ <strong>wlan0</strong>.</li>
<li>æ‰‹åŠ¨åˆ›å»º <code>/etc/wpa_supplicant/wpa_supplicant.conf</code> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wpa_passphrase &lt;SSID&gt; &lt;PASSWORD&gt; &gt;/etc/wpa_supplicant/wpa_supplicant.conf</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li>iw</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">iw dev wlan0 scan | grep &#x27;SSID:&#x27;</span><br><span class="line">iw dev wlan0 connect &lt;SSID&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>iproute2</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ip link show wlan0</span><br><span class="line">ip addr wlan0</span><br></pre></td></tr></table></figure>
<ul>
<li>dhcpcd5</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable dhcpcd.service</span><br><span class="line">systemctl start dhcpcd.service</span><br></pre></td></tr></table></figure>
<ul>
<li>ntpdate</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/sbin/ntpdate ntp.aliyun.com</span><br></pre></td></tr></table></figure>
<h1 id="display-on-hikey970"><a class="markdownIt-Anchor" href="#display-on-hikey970"></a> Display on HiKey970</h1>
<p><img src="/images/hikey970/hikey970-display.svg" alt="From claude.ai" /></p>
<h2 id="dsi-bridge-probe"><a class="markdownIt-Anchor" href="#dsi-bridge-probe"></a> <a target="_blank" rel="noopener" href="https://lore.kernel.org/dri-devel/e5ec9763-37fe-6cd8-6eca-52792afbdb94@samsung.com/T/">DSI bridge probe</a></h2>
<p>DSI bridge driver probe <a target="_blank" rel="noopener" href="https://gist.github.com/lucmann/7ae4bf26d49807a4d951db2e989a271c">é™·å…¥æ­»å¾ªç¯</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[    3.270639] [drm] the bridge node is adv7533</span><br><span class="line">[    3.270645] [drm] wait for external HDMI bridge driver.</span><br><span class="line">[    3.270832] of_irq_parse_raw:  /soc/gpio@e8a0c000:00000001,00000002</span><br><span class="line">[    3.270905] adv7511_probe dev-&gt;of_node (____ptrval____)</span><br><span class="line">[    3.270909] __devm_drm_bridge_alloc</span><br><span class="line">[    3.271426] adv7511_init_regulators</span><br><span class="line">[    3.330257] [drm] the bridge node is adv7533</span><br><span class="line">[    3.330264] [drm] wait for external HDMI bridge driver.</span><br><span class="line">[    3.330449] of_irq_parse_raw:  /soc/gpio@e8a0c000:00000001,00000002</span><br><span class="line">[    3.330522] adv7511_probe dev-&gt;of_node (____ptrval____)</span><br><span class="line">[    3.330526] __devm_drm_bridge_alloc</span><br><span class="line">[    3.331015] adv7511_init_regulators</span><br><span class="line">[    3.390209] [drm] the bridge node is adv7533</span><br><span class="line">[    3.390215] [drm] wait for external HDMI bridge driver.</span><br><span class="line">[    3.390397] of_irq_parse_raw:  /soc/gpio@e8a0c000:00000001,00000002</span><br><span class="line">[    3.390464] adv7511_probe dev-&gt;of_node (____ptrval____)</span><br><span class="line">[    3.390468] __devm_drm_bridge_alloc</span><br><span class="line">[    3.390937] adv7511_init_regulators</span><br><span class="line">[    3.446194] [drm] the bridge node is adv7533</span><br><span class="line">[    3.446200] [drm] wait for external HDMI bridge driver.</span><br></pre></td></tr></table></figure>
<p>æŒ‰ç…§ä¸Šæ¸¸å¯¹ hisilicon/kirin/dw_drm_dsi.c çš„<a target="_blank" rel="noopener" href="https://lists.freedesktop.org/archives/freedreno/2021-October/012892.html">ä¿®æ”¹</a>ï¼Œå°† hikey9xx/gpu/kirin9xx_dw_drm_dsi.c ä¸­çš„ <code>dsi_probe()</code> åœ¨ probe ordering è°ƒæ•´åå¯è§£å†³æ­¤é—®é¢˜</p>
<p><img src="/images/hikey970/dsi_probe_ordering_comparison.svg" alt="From claude.ai" /></p>
<h1 id="panfrost-on-hikey970"><a class="markdownIt-Anchor" href="#panfrost-on-hikey970"></a> Panfrost on HiKey970</h1>
<p>PathorÂ© å’Œ Tyr(Rust) éƒ½æ˜¯ä¸º Valhall æ¶æ„ä»¥ä¸Šçš„ Mali GPU (å³åŸºäº Command Stream Frontend çš„ GPU) è€Œå†™çš„é©±åŠ¨, HiKey 970 (HI3670 SoC) æ­è½½çš„æ˜¯ Mali G72 MP12 (Bifrost)ï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨ Panfrost é©±åŠ¨ã€‚ä¸Šé¢å¯ä»¥å¯åŠ¨çš„å†…æ ¸æ˜¯ v4.19, å½“æ—¶çš„ GPU é©±åŠ¨è¿˜æ˜¯ lima.</p>
<p>HiKey 970 å¼€å‘æ¿å¯¹åº”çš„ devicetree æºæ–‡ä»¶ <strong>hi3670-hikey970.dts</strong>ï¼Œ åœ¨ v4.19 æ—¶ä¹Ÿåˆå…¥äº†ä¸»çº¿ã€‚</p>
<blockquote>
<p>commit 5510ee99c0deb0c0235acee6498a6745c8317df1<br />
Refs: v4.19-rc1-6-g5510ee99c0de<br />
Author:     Manivannan Sadhasivam <a href="mailto:mani@kernel.org">mani@kernel.org</a><br />
AuthorDate: Fri Aug 10 23:23:39 2018 +0530<br />
Commit:     Wei Xu <a href="mailto:xuwei5@hisilicon.com">xuwei5@hisilicon.com</a><br />
CommitDate: Wed Sep 19 16:15:25 2018 +0100</p>
<pre><code>arm64: dts: Add devicetree support for HiKey970 board

Add devicetree support for HiKey970 development board which
based on Hi3670 SoC and is also one of the 96Boards Consumer
Edition and AI platform.

Only UART6 is enabled which is the default console required
by the 96Boards Consumer Edition Specification.

This patch has been tested on HiKey970 Board.

Signed-off-by: Manivannan Sadhasivam &lt;manivannan.sadhasivam@linaro.org&gt;
Signed-off-by: Wei Xu &lt;xuwei5@hisilicon.com&gt;
</code></pre>
<hr />
<p>arch/arm64/boot/dts/hisilicon/hi3670-hikey970.dts | 35 +++++++++++++++++++++++++++++++++++<br />
1 file changed, 35 insertions(+)</p>
</blockquote>
<h2 id="v619"><a class="markdownIt-Anchor" href="#v619"></a> v6.19</h2>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä½¿ç”¨ <a target="_blank" rel="noopener" href="https://github.com/mengzhuo/hikey970-ubuntu-image">@mengzhuo/hikey970-ubuntu-image</a> å¯ä»¥æ­£å¸¸å¯åŠ¨ HiKey970ï¼Œè€Œä¸”å®‰è£…äº† Xfceï¼Œæ‰€ä»¥æˆ‘ fork äº†è¿™ä¸ªä»“åº“ï¼Œå°†å…¶æ›´åä¸º <a target="_blank" rel="noopener" href="https://github.com/lucmann/hikey970-debian-image">hikey970-debian-image</a>ï¼Œå°†åŸºäº Ubuntu bionic (18.04 LTS) çš„ rootfs.img ç§»æ¤åˆ°åŸºäº Debian bookworm (12) çš„ rootfs.imgï¼Œå¹¶æˆåŠŸå¯åŠ¨ã€‚ä¹‹åå‡†å¤‡å°†è¿™å— 2018 å¹´ 3 æœˆå‘å¸ƒçš„æ¿å­ä½œä¸ºå­¦ä¹ å’Œæµ‹è¯•å†…æ ¸æœ€æ–°é©±åŠ¨çš„å¹³å°ï¼Œæ‰€ä»¥ç°åœ¨å°±çœ‹çœ‹ä¸»çº¿ç¼–è¯‘çš„è®¾å¤‡æ ‘ (arch/arm64/boot/dts/hisilicon/hi3670-hikey970.dtb) å’Œå†…æ ¸ (arch/arm64/boot/Image.gz) æ˜¯å¦èƒ½æ­£å¸¸å¯åŠ¨ã€‚</p>
<ul>
<li>kernel + dtb<br />
<img src="/images/hikey970/try-latest-kernel-on-hikey970.png" alt="Try latest kernel on hikey970" /></li>
<li>kernel only<br />
<img src="/images/hikey970/try-latest-kernel-on-hikey970-2.png" alt="Try latest kernel on hikey970" /></li>
</ul>
<h3 id="random-crng-init-done-took-70-minutes"><a class="markdownIt-Anchor" href="#random-crng-init-done-took-70-minutes"></a> <code>random: crng init done</code> took <strong>70</strong> minutes</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[    5.201987] random: perl: uninitialized urandom read (4 bytes read)</span><br><span class="line">[    5.202263] random: perl: uninitialized urandom read (4 bytes read)</span><br><span class="line">[FAILED] Failed to start systemd-raâ€¦rvice - Load/Save Random Seed.</span><br><span class="line">See &#x27;systemctl status systemd-random-seed.service&#x27; for details.</span><br><span class="line">         Starting systemd-tmpfiles-â€¦leanup of Temporary Directories...</span><br><span class="line">[  OK  ] Finished systemd-tmpfiles-â€¦ Cleanup of Temporary Directories.</span><br><span class="line">         Starting dpkg-db-backup.seâ€¦ly dpkg database backup service...</span><br><span class="line">         Starting logrotate.service - Rotate log files...</span><br><span class="line">[  OK  ] Finished dpkg-db-backup.seâ€¦aily dpkg database backup service.</span><br><span class="line">[  OK  ] Finished logrotate.service - Rotate log files.</span><br><span class="line">[ 4396.712657] random: crng init done</span><br><span class="line">[ 4396.712674] random: 4 urandom warning(s) missed due to ratelimiting</span><br></pre></td></tr></table></figure>
<p>crng init èŠ±è¿™ä¹ˆé•¿æ—¶é—´çš„åŸå› æ˜¯ç³»ç»Ÿ entropy sources ä¸è¶³ï¼Œå†…æ ¸ä¸€ç›´åœ¨å¡«å…… entropy pool, è¿™ç§æƒ…å†µåªå‘ç”Ÿåœ¨åˆ·å†™ç³»ç»Ÿåç¬¬ä¸€æ¬¡å¯åŠ¨ï¼Œä¹‹å entropy pool åº”è¯¥å›ºåŒ–åœ¨ UFS å­˜å‚¨é‡Œäº†ï¼Œå¯åŠ¨æ—¶é—´å°±æ­£å¸¸äº†ã€‚ä½†å› ä¸ºéœ€è¦é¢‘ç¹åˆ·å†™ç³»ç»Ÿï¼Œæ‰€ä»¥è¿˜æ˜¯å¾—è§£å†³è¿™ä¸ªé—®é¢˜ã€‚å°è¯•äº† rng-tools5 å’Œ haveged åï¼Œå‘ç° haveged å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ç†è®ºä¸Š rng-tools5/rng-tools ä¹Ÿå¯ä»¥å€ŸåŠ© <code>/dev/hwrng</code> è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†ä¸çŸ¥ä¸ºä½• rngd æœåŠ¡å§‹ç»ˆ<a target="_blank" rel="noopener" href="https://gist.githubusercontent.com/lucmann/bfabaac6a2c904877629dd3ce97229eb/raw/ceb01cbe992a09d8e1c20a944ea272c8145c7a67/rngd.log">ä¸èƒ½æ­£å¸¸å·¥ä½œ</a>ï¼Œæ€€ç–‘å¯èƒ½æ˜¯ Hi3670 SoC çš„ TRNG é©±åŠ¨æœ‰é—®é¢˜ã€‚</p>
<h3 id="sd-å¡ä¸è¯†åˆ«"><a class="markdownIt-Anchor" href="#sd-å¡ä¸è¯†åˆ«"></a> SD å¡ä¸è¯†åˆ«</h3>
<p>ç°è±¡ï¼šç³»ç»Ÿå¯åŠ¨å <code>lsblk</code> çœ‹ä¸åˆ° <code>/dev/mmcblk0</code></p>
<p>ä½¿ç”¨åŸæ¥çš„ <a target="_blank" rel="noopener" href="https://github.com/mengzhuo/hikey970-ubuntu-image">hikey970-ubuntu-image (@mengzhuo)</a> é•œåƒï¼ŒSD å¡æ˜¯æ­£å¸¸è¯†åˆ«çš„ï¼Œè¿™å°±è¯´æ˜ç”µæºå’Œå¡æœ¬èº«æ²¡æœ‰é—®é¢˜(ä¹‹å‰å› ä¸ºä½¿ç”¨ 12V çš„ç”µæº, fastboot flash æ€»æ˜¯å¤±è´¥çš„æ•™è®­å¾ˆæ·±åˆ»ğŸ¶)ã€‚</p>
<p>å°†ä¸‹æ¥ä¸»è¦æ’æŸ¥è®¾å¤‡æ ‘å’Œå†…æ ¸é…ç½®çš„é—®é¢˜ï¼Œåœ¨è¿™é‡Œå’Œ ChatGPT/DeepSeek äº¤æµäº†å¾ˆå¤šï¼Œæ€»ä½“æ„Ÿè§‰ ChatGPT åœ¨è¿™æ–¹é¢æ¯” DeepSeek é è°±ä¸€ç‚¹ã€‚äº†è§£åˆ°äº† HI3670 SoC çš„ MMC æ§åˆ¶å™¨ä½¿ç”¨çš„æ˜¯ Synopsis DesignWare MMC, å®ƒæ˜¯ä¸€ç§ä¸éµå¾ª SD Host Controller Interface è§„èŒƒçš„å‚å®¶è‡ªå®šä¹‰æ¥å£ã€‚</p>
<h3 id="sd-å¡å¯åŠ¨"><a class="markdownIt-Anchor" href="#sd-å¡å¯åŠ¨"></a> SD å¡å¯åŠ¨</h3>
<p>SD å¡å¯åŠ¨æœ‰ä¸¤ä¸ªä¸»è¦é—®é¢˜:</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/lucmann/hikey970-debian-image/blob/hikey970-debian-image/hikey970_dual_boot_builder.sh">å‡†å¤‡å¥½ sdcard.img</a></li>
<li>è®© UEFI èƒ½å¤Ÿè¯†åˆ« sdcard ä¸Šçš„ boot åˆ†åŒº</li>
</ul>
<p><img src="/images/hikey970/BootManager.png" alt="Hikey970 BootManager" /><br />
<img src="/images/hikey970/DevicesList.png" alt="Hikey970 BootManager" /><br />
<img src="/images/hikey970/BootFromFile.png" alt="Hikey970 BootManager" /><br />
<img src="/images/hikey970/boot_sdcard_0x30a7d232_0x3f_0x7ffc1.png" alt="Hikey970 BootManager" /><br />
<img src="/images/hikey970/grub.png" alt="Hikey970 BootManager" /></p>
<h1 id="å‚è€ƒ"><a class="markdownIt-Anchor" href="#å‚è€ƒ"></a> å‚è€ƒ</h1>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.96boards.org/documentation/consumer/hikey/hikey970/hardware-docs/files/hikey970-user-manual.pdf">HiKey970 User Guide</a></li>
<li><a target="_blank" rel="noopener" href="https://www.96boards.org/documentation/consumer/hikey/hikey970/installation/board-recovery.md.html">HiKey970 Board Recovery</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/96boards/documentation/tree/master/consumer/hikey/hikey970">HiKey970 GitHub</a></li>
<li><a target="_blank" rel="noopener" href="https://www.96boards.org/documentation/consumer/hikey/hikey620/installation/linux-sd-boot.md.html">Create a Bootable SD Card for HiKey</a></li>
<li><a target="_blank" rel="noopener" href="https://releases.linaro.org/96boards/reference-platform/debian/hikey/">Linaro downloads</a></li>
<li><a target="_blank" rel="noopener" href="https://lore.kernel.org/bpf/20200820100440.2d30dc02@coco.lan/T/">DRM driver for HiKey 970</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/dorssel/usbipd-win/issues/59">usbipd-win github issues</a></li>
<li><a target="_blank" rel="noopener" href="https://notes.leconiot.com/debootstrap.html">è·¨å¹³å°æ›´æ–°åˆ¶ä½œ rootfs</a></li>
<li><a target="_blank" rel="noopener" href="https://www.collabora.com/news-and-blog/news-and-events/racing-karts-on-a-rust-gpu-kernel-driver.html">Racing karts on a Rust GPU kernel driver</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/lucmann/hikey970-ubuntu-image">åˆ¶ä½œ Hikey970 çš„ rootfs</a></li>
<li><a target="_blank" rel="noopener" href="https://uefi.org/sites/default/files/resources/UEFI_Shell_Spec_2_0_Errata_A.pdf">UEFI Shell Specification</a></li>
<li><a target="_blank" rel="noopener" href="https://patchwork.kernel.org/project/dri-devel/patch/20190627151740.2277-1-matt.redfearn@thinci.com/">When should ADV7511 bridge attach to DSI host</a></li>
</ul>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Hardware/" rel="tag"># Hardware</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/lnx/syscall/" rel="prev" title="Syscall vs C routines">
                  <i class="fa fa-angle-left"></i> Syscall vs C routines
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/gfx/mesa-llvm/" rel="next" title="Mesa å¯¹ LLVM çš„ä¾èµ–">
                  Mesa å¯¹ LLVM çš„ä¾èµ– <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  <div class="comments" id="disqus_thread">
    <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
  </div>
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2026</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Luc</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"forest","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.4.0/mermaid.min.js","integrity":"sha256-G8ouPAnw4zzMbnAenHnVz6h9XpKbNdOkrqTh7AadyHs="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>





  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


  <script class="next-config" data-name="leancloud_visitors" type="application/json">{"enable":true,"app_id":"RIqzuwdV0iZwT6XIZjv74zCj-MdYXbMMI","app_key":"9gRe7wBvmmjIneYA9pYAJywK","server_url":null,"security":false}</script>
  <script src="/js/third-party/statistics/lean-analytics.js"></script>


  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" integrity="sha256-UF1fgpAiu3tPJN/uCqEUHNe7pnr+QR0SQDNfgglgtcM=" crossorigin="anonymous">


<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"lucmann-github-io","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</body>
</html>
