---
title: Resizable PCI BAR
date: 2025-03-12 15:00:41
tags: [Hardware]
categories: hardware
---

![PCIe Type 0 (Non-Bridge) Configuration Space Header](/images/pci/Pci-config-space.svg)

<!--more-->

# PCI config space

A set of registers

```
pci 0000:00:00.0: config space:
00000000: 86 80 34 3e 06 00 90 20 0c 00 00 06 00 00 00 00
00000010: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00000020: 00 00 00 00 00 00 00 00 00 00 00 00 28 10 20 09
00000030: 00 00 00 00 e0 00 00 00 00 00 00 00 00 00 00 00
00000040: 01 90 d1 fe 00 00 00 00 01 00 d1 fe 00 00 00 00
00000050: c1 02 00 00 b1 80 00 00 47 00 70 8f 07 01 00 8a
00000060: 01 00 00 e0 00 00 00 00 01 80 d1 fe 00 00 00 00
00000070: 00 00 00 fc 01 00 00 00 00 0c 00 fc 7f 00 00 00
00000080: 01 00 00 00 00 00 00 00 1a 00 00 00 00 00 00 00
00000090: 01 00 00 fc 01 00 00 00 01 00 70 6c 02 00 00 00
000000a0: 01 00 00 00 02 00 00 00 01 00 80 6c 02 00 00 00
000000b0: 01 00 80 8b 01 00 00 8b 01 00 00 8a 01 00 80 8f
000000c0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
000000d0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
000000e0: 09 00 10 01 c1 60 61 7a 8c 80 11 94 00 c0 04 00
000000f0: 00 00 00 00 c8 0f 0c 00 00 00 00 00 00 00 00 00
pci 0000:00:00.0: [8086:3e34] type 00 class 0x060000 conventional PCI endpoint
pci 0000:00:02.0: config space:
00000000: 86 80 a0 3e 07 00 10 00 02 00 00 03 00 00 00 00
00000010: 04 00 00 c0 00 00 00 00 0c 00 00 b0 00 00 00 00
00000020: 01 40 00 00 00 00 00 00 00 00 00 00 28 10 20 09
00000030: 00 00 00 00 40 00 00 00 00 00 00 00 ff 01 00 00
00000040: 09 70 0c 01 c1 60 61 7a 8c 80 11 94 00 00 00 00
00000050: c1 02 00 00 b1 80 00 00 00 00 00 00 01 00 80 8b
00000060: 00 00 01 00 00 00 00 00 00 00 00 00 00 00 00 00
00000070: 10 ac 92 00 00 80 00 10 00 00 00 00 00 00 00 00
00000080: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
00000090: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
000000a0: 00 00 00 00 00 00 00 00 00 00 00 00 05 d0 00 00
000000b0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
000000c0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
000000d0: 01 00 22 00 00 00 00 00 00 00 00 00 00 00 00 00
000000e0: 00 00 00 00 00 00 00 00 00 80 00 00 00 00 00 00
000000f0: 00 00 00 00 00 00 00 00 00 00 00 00 18 00 e1 88
pci 0000:00:02.0: [8086:3ea0] type 00 class 0x030000 PCIe Root Complex Integrated Endpoint
pci 0000:00:02.0: BAR 0 [mem 0xc0000000-0xc0ffffff 64bit]
pci 0000:00:02.0: BAR 2 [mem 0xb0000000-0xbfffffff 64bit pref]
pci 0000:00:02.0: BAR 4 [io  0x4000-0x403f]
pci 0000:00:02.0: Video device with shadowed ROM at [mem 0x000c0000-0x000dffff]
```
上面的 PCI config space dump 可以通过内核启动参数 <span style="background-color: yellow; padding: 4px;">pci=earlydump</span> 开启打印

## Access to config space

内核访问 PCI config space 的 API 都定义在 `drivers/pci/access.c` 中

```
int pci_read_config_byte(const struct pci_dev *dev, int where, u8 *val);
```
